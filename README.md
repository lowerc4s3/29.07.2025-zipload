# zipload - сервер для скачивания файлов и запаковки в zip-архив
Сервер, получающий ссылки на файлы, скачивающий их, и отправляющий их обратно в
zip-архиве. Реализация тестового задания от 29.07.2025.

## Использование
Условия для работы:
- go >=v1.24

Команда для запуска:
```sh
go run main.go
# Либо можно собрать и запустить
go build main.go
./main
```

## Описание архитектурных решений
В качестве архитектурного стиля API был выбран RPC с форматом сообщений JSON,
так как некоторые эндпоинты лучше представляются как действия (например, загрузка
всех файлов разом). Впрочем, реализация в стиле REST API так же имеет смысл,
особенно при работе с задачами. Задачи идентифицируются при помощи UUID для
уменьшения возможности столкнуться с чужой задачей. Приложение писалось с учетом
чистой архитектуры и DDD.

### Что можно улучшить
Эти моменты были упущены из-за нехватки времени:
1. На данный момент получить метаданные файла можно только после его полной
   загрузки, что неэффективно в случае, если файл большой, а его тип недопустим;
2. Недостает логирования и тестов;
3. Функция DownloadAll не была переписана с использованием GoArchiver и
   достаточно крупна;
4. В случае разрастания конфигурационного файла имеет смысл использовать
   библиотеку Viper;
5. Недостает документации API в Swagger.

## Эндпоинты
Запросы и ответы приходят в формате JSON

### POST /downloadBatch
Запрос на загрузку нескольких ресурсов и получение архива

Тело запроса:
```json
{
    "sources": [
        "url1",
        "url2",
        "url3"
    ]
}
```

Тело ответа: zip-архив

Статусы:
- 200 в случае успеха
- 206, если некоторые файлы не были скачаны
- 502, если не получилось скачать ни одного файла из-за ошибок скачивания
- 400, если у всех файлов недопустимый MIME тип

> [!NOTE]
> В случае частично заполненного архива возвращается статус 206 Partial
> Content, что является нестандартным применением этого статуса и используется
> для того, чтобы не изменять формат ответа в случае ошибки

### POST /createTask
Запрос на создание новой задачи

Тело запроса: отсутствует

Тело ответа:
```json
{
    "id": "uuid"
}
```

Статусы ответа:
- 201 в случае успеха
- 503, если достигнуто макс. кол-во задач

### POST /appendTask
Запрос на добавление файла в задачу

Тело запроса:
```json
{
    "id": "uuid",
    "source": "url"
}
```

Тело ответа: отсутствует

Статусы ответа:
- 202 в случае успеха
- 400, если достигнуто макс. кол-во файлов в задаче
- 404, если задачи с таким UUID не существует

### GET /checkTask/:taskID
Запрос на получение статуса задачи

Тело запроса: отсутствует

Тело ответа:
```jsonc
{
    "files": [
        {
            "url": "url",
            "status": "downloading | done | failed"
        }
    ],
    "link": "/downloadTask/:uuid" // Отсутствует, если задач меньше трех
}
```

Статусы ответа:
- 200 в случае успеха
- 404, если задачи с таким UUID не существует

### GET /downloadTask/:taskID
Запрос на загрузку архива задачи

Тело запроса: отсутствует

Тело ответа: zip-архив

Статусы ответа:
- 200 в случае успеха
- 404, если задачи с таким UUID не существует
